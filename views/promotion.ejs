<!DOCTYPE html>
<html>
<head>
    <title>Promotion</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-datalabels/2.2.0/chartjs-plugin-datalabels.min.js" integrity="sha512-JPcRR8yFa8mmCsfrw4TNte1ZvF1e3+1SdGMslZvmrzDYxS69J7J49vkFL8u6u8PlPJK+H3voElBtUCzaXj+6ig==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" type="text/css" href="/styles.css">
    <script src="/search_box.js"></script>
</head>
<body>
<div class="wrapper">
    <%- include('partials/sidebar') %>
    <div class="main_content">
        <div class="header" style="text-transform: uppercase;"><h2>Promotion <i class="fas fa-tags"></i></h2></div>
        <div class="info">
            <div class="table">
                <section class="table__header">
                    <h2>Redemption History</h2>
                    <div class="input-group">
                        <input type="search" id="searchData" name="searchData" placeholder="Search Data...">
                        <i class="fa fa-search" aria-hidden="true"></i>
                    </div>
                </section>
                
                <table class="content-table">
                <thead>
                    <tr>
                        <th>Promotion ID <span class="icon-arrow">&#11014;</span></th>
                        <th>Promotion Name <span class="icon-arrow">&#11014;</span></th>
                        <th>Promotion Description <span class="icon-arrow">&#11014;</span></th>
                        <th>Expiration Date <span class="icon-arrow">&#11014;</span></th>
                        <th>Status <span class="icon-arrow">&#11014;</span></th>
                        <th>Point Cost <span class="icon-arrow">&#11014;</span></th>
                        <th>Edit / Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Use EJS syntax to iterate through promotions and generate table rows -->
                    <% promotions.forEach(promotion => { %>
                            <td><%= promotion.promo_name %></td>
                            <td><%= promotion.promo_description %></td>
                            <td><%= promotion.expiration_date %></td>
                            <td>
                                <div class="status <%= promotion.promo_status %>"><%= promotion.promo_status %></div>
                              </td>
                            <td><%= promotion.promo_cost %></td>
                            <td>
                                <button class="edit-button" onclick="editPromotion('<%= promotion.id %>')">Edit</button>
                                <button class="delete-button" onclick="deletePromotion('<%= promotion.id %>')">Delete</button>
                            </td>
                        </tr>
                    <% }); %>
                </tbody>
                </table>
             </div>
             
             <!-- Adding new promotion form -->
             <div class="table">
                <section class="table__header">
                    <h2>Add New Promotion</h2>
                </section>
                <form id="addPromotionForm" action="/addPromotion" method="POST">
                    <table class="content-table">
                        <tbody>
                            <tr>
                                <td><label for="promotionName">Promotion Name:</label></td>
                                <td colspan="3"><input type="text" name="promotionName" required></td>
                            </tr>
                            <tr>
                                <td><label for="promotionDescription">Description:</label></td>
                                <td colspan="3"><input type="text" name="promotionDescription" required></td>
                            </tr>
                            <tr>
                                <td><label for="pointsCost">Points Cost:</label></td>
                                <td>
                                    <input type="text" name="pointsCost" required>
                                </td>
                                <td><label for="expirationDate">Expiration Date:</label></td>
                                <td>
                                    <div class="input-with-calendar">
                                        <i class="fa fa-calendar" aria-hidden="true"></i> <!-- Calendar icon --> <p>&nbsp</p>
                                        <input type="text" name="manualExpirationDate" id="manualExpirationDate" placeholder="MM/DD/YYYY">
                                    </div>
                                    <input type="date" name="expirationDate" id="expirationDate" style="display: none;" required>
                                </td>
                            </tr>
                            <tr>
                                <td><label for="status">Status:</label></td>
                                <td>
                                    <label>
                                        <input type="radio" name="status" value="ACTIVE" checked>
                                        ACTIVE
                                    </label>
                                </td>
                                <td>
                                    <label>
                                        <input type="radio" name="status" value="INACTIVE">
                                        INACTIVE
                                    </label>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td></td> <!-- Empty cell for spacing -->
                                <td></td>
                                <td></td>
                                <td><button type="button" id="submitPromotion">Add Promotion</button></td>
                            </tr>
                        </tbody>
                    </table>
                </form>
            </div>            
        </div>
    </div>
</div>
<script>
    document.getElementById('submitPromotion').addEventListener('click', function() {
        // Get the form data
        const pointsCost = document.querySelector('[name="pointsCost"]').value;
        const expirationDate = document.querySelector('[name="expirationDate"]').value;
        const description = document.querySelector('[name="description"]').value;
        const status = document.querySelector('[name="status"]').checked ? 'ACTIVE' : 'INACTIVE';

        // Create a new table row
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>New ID</td>
            <td>${description}</td>
            <td>${description}</td>
            <td>${pointsCost}</td>
            <td>${expirationDate}</td>
            <td class="${status}">${status}</td>
            <td>Edit / Delete</td>
        `;

        // Append the new row to the table
        document.querySelector('.content-table tbody').appendChild(newRow);
    });
</script>


</body>
</html>
